# Exemple de fichier de secrets pour whitelily (VM n8n automation)
# Copier ce fichier en secrets/whitelily.yaml et le chiffrer avec sops
#
# IMPORTANT: Ce fichier doit √™tre chiffr√© avant de le committer !
# NE JAMAIS COMMITTER LE FICHIER NON CHIFFR√â !
#
# Pour cr√©er et chiffrer le fichier de secrets:
# 1. Copier ce fichier: cp secrets/whitelily.yaml.example secrets/whitelily.yaml
# 2. √âditer avec sops: sops secrets/whitelily.yaml
# 3. Remplacer les valeurs avec vos vrais secrets
#
# IMPORTANT: Vous devez d'abord copier la cl√© age partag√©e sur la VM whitelily
# cp ~/.config/sops/age/nixos-shared-key.txt √† /var/lib/sops-nix/key.txt (sur la VM)

# ========================================
# SECRETS UTILISATEUR
# ========================================

# Hash du mot de passe pour l'utilisateur jeremie
# G√©n√©rer avec: mkpasswd -m sha-512
# Le m√™me que pour magnolia si tu veux utiliser le m√™me mot de passe
jeremie-password-hash: $6$g/9Fke6IjYVALC5S$.uMMuJpIgro1MxwzBtvBMG7G2pP88ulMtl91kPWdg3nEuE3uigDQ164yqvtEEGKiFtuN8RaFok66AiIIwErvq1

# ========================================
# SECRETS N8N
# ========================================

# Cl√© de chiffrement n8n (CRITIQUE - NE JAMAIS PERDRE CETTE CL√â)
# G√©n√©rer avec: openssl rand -hex 32
# Cette cl√© chiffre toutes les credentials dans n8n
# Si tu la perds, tu perds TOUTES tes credentials n8n !
n8n:
  encryption_key: "REMPLACER_PAR_VRAIE_CLE_GENEREE_AVEC_OPENSSL_RAND_HEX_32"

  # Authentification basique n8n
  # Username pour l'acc√®s √† l'interface n8n
  basic_user: "admin"

  # Mot de passe pour l'acc√®s √† l'interface n8n
  # G√©n√©rer un mot de passe fort
  basic_pass: "REMPLACER_PAR_MOT_PASSE_FORT"

  # Mot de passe pour la base de donn√©es PostgreSQL
  # G√©n√©rer avec: openssl rand -base64 32
  db_password: "REMPLACER_PAR_MOT_PASSE_DB_GENERE_AVEC_OPENSSL"

# ========================================
# CLOUDFLARE TUNNEL
# ========================================

# Credentials JSON du tunnel Cloudflare
# Obtenir depuis: https://one.dash.cloudflare.com/
# ‚Üí Access ‚Üí Tunnels ‚Üí [Ton tunnel] ‚Üí Configure ‚Üí Credentials
# Format JSON complet √† copier-coller
cloudflared:
  credentials: |
    {
      "AccountTag": "REMPLACER_PAR_TON_ACCOUNT_TAG",
      "TunnelSecret": "REMPLACER_PAR_TON_TUNNEL_SECRET",
      "TunnelID": "REMPLACER_PAR_TON_TUNNEL_ID"
    }

# ========================================
# INSTRUCTIONS DE G√âN√âRATION DES SECRETS
# ========================================

# 1. Cl√© de chiffrement n8n (CRITIQUE) :
#    openssl rand -hex 32
#    Sauvegarder cette cl√© dans un gestionnaire de mots de passe !

# 2. Mot de passe basic_pass (fort) :
#    openssl rand -base64 24
#    ou utiliser un gestionnaire de mots de passe

# 3. Mot de passe DB PostgreSQL :
#    openssl rand -base64 32

# 4. Hash du mot de passe utilisateur :
#    mkpasswd -m sha-512
#    (te demandera d'entrer le mot de passe interactivement)

# 5. Cloudflare Tunnel credentials :
#    a. Aller sur https://one.dash.cloudflare.com/
#    b. Navigation: Zero Trust ‚Üí Access ‚Üí Tunnels
#    c. Cr√©er un nouveau tunnel ou utiliser un existant
#    d. Nom du tunnel: "n8n-whitelily"
#    e. Dans Configure, copier le JSON des credentials
#    f. Configurer la route publique:
#       - Public hostname: n8nv2.jeremiealcaraz.com (ton domaine)
#       - Service: http://localhost:80
#       - Sauvegarder

# ========================================
# CHECKLIST AVANT DE CHIFFRER
# ========================================
# [ ] Tous les "REMPLACER_PAR" ont √©t√© remplac√©s
# [ ] La cl√© encryption_key est sauvegard√©e dans un gestionnaire de mots de passe
# [ ] Le tunnel Cloudflare est cr√©√© et configur√©
# [ ] Les credentials Cloudflare sont valides (JSON complet)
# [ ] Le domaine est bien configur√© dans hosts/whitelily/n8n.nix

# ========================================
# COMMANDES POUR CHIFFRER
# ========================================
# sops secrets/whitelily.yaml
# (√©diter les valeurs, sauvegarder, sops chiffrera automatiquement)

# V√©rifier que c'est bien chiffr√© :
# cat secrets/whitelily.yaml | grep "sops:"

# Si oui, tu peux committer :
# git add -f secrets/whitelily.yaml
# git commit -m "üîí Add encrypted secrets for whitelily"
